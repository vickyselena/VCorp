<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login / Register - VCorp</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#F8FAFC;--primary:#1E293B;--green:#10B981;--gray:#64748B;--card:#FFFFFF;--radius:24px;--shadow:0 20px 50px -12px rgba(0,0,0,0.12)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:linear-gradient(135deg,#6366f1,#8b5cf6);font-family:'Inter',sans-serif;min-height:100vh;display:grid;place-items:center;padding:20px;color:var(--primary)}
    .card{background:var(--card);max-width:440px;width:100%;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .header{background:linear-gradient(135deg,var(--primary),#0f172a);color:white;padding:3rem 2rem 2rem;text-align:center}
    .logo{font-family:'Outfit',sans-serif;font-size:3rem;font-weight:900}
    .logo span{color:#94a3b8;font-style:italic;font-weight:400}
    .tabs{display:flex;background:#f1f5f9}
    .tab{flex:1;padding:16px;text-align:center;font-weight:600;cursor:pointer;transition:.3s}
    .tab.active{background:white;color:var(--primary);border-bottom:4px solid var(--green)}
    .form-body{padding:2.5rem 2rem}
    input{width:100%;padding:16px 20px;margin:10px 0 20px;border:2px solid #e2e8f0;border-radius:16px;font-size:1rem;transition:.3s}
    input:focus{border-color:var(--green);outline:none;box-shadow:0 0 0 4px rgba(16,185,129,.1)}
    .btn{width:100%;padding:16px;background:var(--green);color:white;border:none;border-radius:16px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:.3s}
    .btn:hover{background:#059669;transform:translateY(-2px)}
    .btn.loading{opacity:.7;cursor:not-allowed}
    .msg{padding:12px 16px;border-radius:12px;margin-top:16px;text-align:center;display:none}
    .error{background:#fee2e2;color:#991b1b}
    .success{background:#ecfdf5;color:#065f46}
    .form-section{display:none}
    .form-section.active{display:block}
  </style>
</head>
<body>

<div class="card">
  <div class="header">
    <div class="logo">VC<span>orp</span></div>
    <p>Sistem Inventory Management</p>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('login')">Login</div>
    <div class="tab" onclick="switchTab('register')">Register</div>
  </div>

  <div class="form-body">
    <div id="loginForm" class="form-section active">
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPass" placeholder="Password" required>
      <button class="btn" id="btnLogin">Masuk ke Dashboard</button>
      <div class="msg error" id="loginError"></div>
    </div>

    <div id="registerForm" class="form-section">
      <input type="text" id="regNama" placeholder="Nama Lengkap" required>
      <input type="email" id="regEmail" placeholder="Email" required>
      <input type="password" id="regPass" placeholder="Password (min. 6 karakter)" required>
      <button class="btn" id="btnRegister">Daftar Sekarang</button>
      <div class="msg success" id="regSuccess"></div>
      <div class="msg error" id="regError"></div>
    </div>
  </div>
</div>

<script type="module">
  import { auth, db } from "./firebase-config.js";
  import { signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  window.switchTab = (tab) => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.form-section').forEach(f => f.classList.remove('active'));
    document.querySelector(`.tab:nth-child(${tab==='login'?1:2})`).classList.add('active');
    document.getElementById(tab + 'Form').classList.add('active');
  };

  const showMsg = (id, text, success = false) => {
    const el = document.getElementById(id);
    el.textContent = text;
    el.className = `msg ${success ? 'success' : 'error'}`;
    el.style.display = 'block';
  };

  // LOGIN
  document.getElementById('btnLogin').onclick = async () => {
    const email = document.getElementById('loginEmail').value.trim();
    const pass = document.getElementById('loginPass').value;
    if (!email || !pass) return showMsg('loginError', 'Email & password wajib diisi!');
    
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      location.href = "index.html";
    } catch (e) {
      showMsg('loginError', 'Email atau password salah!');
    }
  };

  // REGISTER â†’ OTOMATIS STAFF
  document.getElementById('btnRegister').onclick = async () => {
    const nama = document.getElementById('regNama').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const pass = document.getElementById('regPass').value;
    if (!nama || !email || !pass) return showMsg('regError', 'Semua field wajib diisi!');
    if (pass.length < 6) return showMsg('regError', 'Password minimal 6 karakter!');

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, pass);
      await set(ref(db, 'users/' + cred.user.uid), {
        nama, email, role: "Staff", registeredAt: new Date().toISOString()
      });
      showMsg('regSuccess', 'Register berhasil! Sedang masuk...', true);
      setTimeout(() => location.href = "index.html", 1500);
    } catch (e) {
      showMsg('regError', e.code === 'auth/email-already-in-use' ? 'Email sudah terdaftar!' : 'Gagal daftar!');
    }
  };
</script>
</body>
</html>
